configurations { schemagen }
dependencies {
    api project(':bpm:bonita-common')
    api project(':bpm:bonita-core:bonita-process-definition')
    api project(':services:bonita-identity')
    api project(':services:bonita-persistence')
    api project(':services:bonita-commons')
    api project(':services:bonita-log')
    api project(':services:bonita-events')
    api project(':services:bonita-archive')
    api project(':services:bonita-data-instance')
    api project(':services:bonita-classloader')
    api project(':bpm:bonita-core:bonita-process-comment')
    api project(':services:bonita-builder')
    api project(':bpm:bonita-core:bonita-home-server')
    api project(':services:bonita-session')
    api project(':services:bonita-connector-executor')
    api project(':services:bonita-resources')
    api project(':services:bonita-time-tracker')
    api project(':services:bonita-expression')
    api project(':services:bonita-cache')
    api project(':bpm:bonita-core:bonita-contract-data')
    testImplementation "junit:junit:${Deps.junit4Version}"
    testImplementation "org.assertj:assertj-core:${Deps.assertjVersion}"
    testImplementation "org.mockito:mockito-core:${Deps.mockitoVersion}"
    testImplementation "com.github.stefanbirkner:system-rules:${Deps.systemRulesVersion}"
    testRuntimeOnly "ch.qos.logback:logback-classic:${Deps.logbackVersion}"

    annotationProcessor "org.projectlombok:lombok:${Deps.lombokVersion}"
    compileOnly "org.projectlombok:lombok:${Deps.lombokVersion}"

    schemagen("org.glassfish.jaxb:jaxb-jxc:${Deps.jaxbJxcVersion}")
}

tasks.register('schemagen') {
    def destDir = file("$buildDir/schemas")
    doLast {
        destDir.mkdirs()
        ant.taskdef(name: 'schemagen', classname: 'com.sun.tools.jxc.SchemaGenTask', classpath: configurations.schemagen.asPath)
        ant.schemagen(srcdir: new File('src/main/java/'), destdir: destDir, includeAntRuntime: false) {
            schema(file: "connectors-impl.xsd", namespace: "http://www.bonitasoft.org/ns/connector/implementation/6.0")
            classpath { pathelement(path: configurations.schemagen.asPath) }
            include(name: 'org/bonitasoft/engine/core/connector/parser/*.java')
        }
    }
    inputs.dir('src/main/java/')
    outputs.file("$destDir/connectors-impl.xsd")
}

processResources { from "$buildDir/schemas" }

tasks.processResources.dependsOn tasks.schemagen

tasks.schemagen.outputs.cacheIf { true }
